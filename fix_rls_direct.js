#!/usr/bin/env node

/**
 * ุญู ูุดููุฉ RLS ูู Supabase
 * ูุฌุจ ุชูููุฐ ูุฐุง ุงูุณูุฑูุจุช ุจุนุฏ ุชูููุฐ ุงูุฃูุงูุฑ SQL ูู ููุญุฉ ุชุญูู Supabase
 */

console.log('\n๐จ ุชู ุชุญุฏูุฏ ุงููุดููุฉ: ุณูุงุณุงุช ุฃูุงู ุงูุตููู (RLS) ูู Supabase ุชููุน ุฅุถุงูุฉ ุจูุงูุงุช ุงููุณุชุฎุฏู! ๐จ\n');

console.log('๐ก ุงูุญู:\n');
console.log('1๏ธโฃ ุงูุชูู ุฅูู ููุญุฉ ุชุญูู Supabase (https://app.supabase.io)');
console.log('2๏ธโฃ ุงุฎุชุฑ ูุดุฑูุนู ูุงูุชูู ุฅูู ูุณู "SQL Editor"');
console.log('3๏ธโฃ ุงูุณุฎ ุงูุฃูุงูุฑ ุงูุชุงููุฉ ููู ุจุชูููุฐูุง:');

console.log(`
-- ุชุนุทูู ุณูุงุณุงุช ุฃูุงู ุงูุตููู ุนูู ุฌุฏูู ุงููุณุชุฎุฏููู
ALTER TABLE users DISABLE ROW LEVEL SECURITY;

-- ููุญ ุฌููุน ุงูุตูุงุญูุงุช ูููุณุชุฎุฏู ุงููุฌููู (anon)
GRANT ALL PRIVILEGES ON TABLE users TO anon;
GRANT USAGE ON SCHEMA public TO anon;
`);

console.log('4๏ธโฃ ุจุนุฏ ุชูููุฐ ูุฐู ุงูุฃูุงูุฑุ ูู ุจุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู ูุชุฌุฑุจุฉ ุญูุธ ุงูุจุฑููุงูู ูุฑุฉ ุฃุฎุฑู.\n');

console.log('๐ ููุงุญุธุฉ ูููุฉ: ูุฐุง ุงูุญู ูู ูุจูุฆุฉ ุงูุชุทููุฑ ููุท! ูู ุงูุฅูุชุงุฌุ ูุฌุจ ุงุณุชุฎุฏุงู ุณูุงุณุงุช RLS ููุงุณุจุฉ ููุฃูุงู.\n');

console.log('๐ ููุงุฐุง ุญุฏุซุช ุงููุดููุฉุ');
console.log('ุณูุงุณุงุช RLS ุชูููุฏ ุงููุตูู ุฅูู ุงูุจูุงูุงุช. ูู ูุฐู ุงูุญุงูุฉุ ูุงูุช ุณูุงุณุฉ RLS ููุนุช ุฅุฏุฑุงุฌ ุจูุงูุงุช ุฌุฏูุฏุฉ.');
console.log('ุงูุฎุทุฃ ุงูุฐู ุธูุฑ: "new row violates row-level security policy for table "users""');
console.log('ูุฐุง ูุนูู ุฃู ุณูุงุณุฉ RLS ุชููุน ุงููุณุชุฎุฏู ุงููุฌููู (anon) ูู ุฅุถุงูุฉ ุตููู ูู ุฌุฏูู users.\n');

console.log('โ ุจุนุฏ ุชุนุทูู RLSุ ุณูุชููู ุงูุชุทุจูู ูู ุฅุฏุฑุงุฌ ูุชุญุฏูุซ ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ!\n');

// ุฏุนููุง ูุชุญูู ูู ุญุงูุฉ ุงูุชุทุจูู ุงูุญุงููุฉ
const fs = require('fs');
const path = require('path');

// ุชุญูู ูู ูุฌูุฏ ููู ุงูุชูููู
const envPath = path.join(__dirname, '.env.local');
if (fs.existsSync(envPath)) {
  console.log('๐พ ุชู ุงูุนุซูุฑ ุนูู ููู .env.local - ุชูููู Supabase ูุชุงุญ.');
  
  try {
    const envContent = fs.readFileSync(envPath, 'utf8');
    if (envContent.includes('NEXT_PUBLIC_SUPABASE_URL') && 
        envContent.includes('NEXT_PUBLIC_SUPABASE_ANON_KEY')) {
      console.log('โ ููุงุชูุญ Supabase ููุฌูุฏุฉ ูู ููู ุงูุชูููู.');
    }
  } catch (e) {
    console.log('โ๏ธ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ูุฑุงุกุฉ ููู ุงูุชูููู.');
  }
}

console.log('\n๐ ุญุธูุง ูููููุง! ุงููุดุฑูุน ุฌููู ููุณุชุญู ุงูุฅููุงู! ๐');
